{
  "db": "SQLite",
  "8c48e05071b21726b52166ac6854f0ed5a9821b1501631fc87cd14eab7512fd7": {
    "describe": {
      "columns": [
        {
          "name": "user_id",
          "ordinal": 0,
          "type_info": "Int64"
        },
        {
          "name": "username",
          "ordinal": 1,
          "type_info": "Text"
        },
        {
          "name": "post_signature",
          "ordinal": 2,
          "type_info": "Text"
        },
        {
          "name": "title",
          "ordinal": 3,
          "type_info": "Text"
        }
      ],
      "nullable": [
        false,
        false,
        true,
        false
      ],
      "parameters": {
        "Right": 1
      }
    },
    "query": "SELECT users.id user_id,\n    users.username,\n    users.post_signature,\n    topics.title\nFROM topics\n    INNER JOIN users ON topics.author_user_id = users.id\nWHERE topics.id = ?"
  },
  "f75ea40c090fa6f5fb99ba86b3e96e84c17f0ca41335a712a1dbb85044b67f45": {
    "describe": {
      "columns": [
        {
          "name": "post_id",
          "ordinal": 0,
          "type_info": "Int64"
        },
        {
          "name": "deleted_at",
          "ordinal": 1,
          "type_info": "Datetime"
        },
        {
          "name": "id",
          "ordinal": 2,
          "type_info": "Int64"
        },
        {
          "name": "created_at",
          "ordinal": 3,
          "type_info": "Datetime"
        },
        {
          "name": "updated_at",
          "ordinal": 4,
          "type_info": "Datetime"
        },
        {
          "name": "author_user_id",
          "ordinal": 5,
          "type_info": "Int64"
        },
        {
          "name": "username",
          "ordinal": 6,
          "type_info": "Text"
        },
        {
          "name": "post_signature",
          "ordinal": 7,
          "type_info": "Text"
        },
        {
          "name": "body",
          "ordinal": 8,
          "type_info": "Text"
        }
      ],
      "nullable": [
        false,
        true,
        true,
        true,
        true,
        true,
        true,
        true,
        true
      ],
      "parameters": {
        "Right": 2
      }
    },
    "query": "-- Select posts from a topic, bindings (current_user, topic_id).\n-- Post contents are visible if they are not deleted or if current user is a moderator to the topic it belongs to.\n-- Post numbers and deletion time are always visible.\nWITH meta AS (\n    SELECT p.id AS post_id,\n        -- ROW_NUMBER() OVER (ORDER BY p.created_at) AS post_number,\n        p.deleted_at\n    FROM topics t\n        INNER JOIN posts p ON t.id = p.topic_id\n    WHERE t.id = ?2\n    ORDER BY p.created_at\n), content AS (\n    SELECT p.id,\n        p.created_at,\n        p.updated_at,\n        p.author_user_id,\n        u.username,\n        u.post_signature,\n        p.body\n    FROM posts p\n        INNER JOIN users u ON p.author_user_id = u.id\n    WHERE p.deleted_at NOT NULL\n        OR EXISTS (\n            SELECT 1\n            FROM topic_moderators m\n            WHERE m.topic_id = p.topic_id\n                AND m.moderator_user_id = ?1\n        )\n)\nSELECT *\nFROM meta\n    LEFT JOIN content;"
  }
}